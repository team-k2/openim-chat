name: Build openim-chat

on:
  push:
    branches: [main, staging, dev]
    tags: ['v*.*.*', 'v*.*.*-k2im*']
  pull_request:
    branches: [main, staging, dev]
  workflow_dispatch:

jobs:
  build:
    name: Build and Push
    uses: team-k2/k2im-infrastructure/.github/workflows/reusable-build-and-push.yml@main
    with:
      service_name: openim-chat
      ecr_repository: k2im/openim-chat
      dockerfile_path: ./Dockerfile
      build_context: .
      dependencies: ''
      run_tests: false  # No Go tests for openim-chat
      run_lint: false
      run_security_scan: true
    secrets:
      AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
      INFRA_REPO_TOKEN: ${{ secrets.INFRA_REPO_TOKEN }}
